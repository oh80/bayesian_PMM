main <- function(){
  #read_data
  missing_rate <- 0.5
  missing_type <- "MCAR"
  file_name <- paste0(missing_type , "_", missing_rate, ".obj")
  path <- here::here("Liner_regression", "02_build","data", file_name)
  data <- readRDS(path)
  
  #param set
  set.seed(428)
  D = 10
  
  #get imputation model
  coefficients <- get_coeffcients(data)
  sigma <- get_sigma(data)
  
  #imputation 
  
  
  return()
}


get_coeffcients <- function(data){
  complete_data <- data |> dplyr::filter(R == 0) |> dplyr::select(-R)
  
  param_list <- list()
  for (j in 1:10) {
    imputed_col <- paste0("x",j)
    formula <- as.formula(paste0(imputed_col, "~ ."))
    lm <- lm(formula = formula, complete_data)
    param_list[[j]] <- coef(lm)
  }
  output <- param_list
  return(output)
}


get_sigma <- function(data){
  complete_data <- data |> dplyr::filter(R == 0) |> dplyr::select(-R)
  sd_list <- list()
  for (j in 1:10) {
    sd_list[j] <- sd(complete_data[,j])
  }
  output <- sd_list
  return(output)
}


get_single_imputation <- function(data, coefficients, sigma){
  output <- data |> dplyr::filter(R == 0)
  for(j in 1:10){
    missing_col <- paste0("x",j)
    missing_data <- data |> dplyr::filter(R == j) |> dplyr::select(-all_of(missing_col))
    n <- length(missing_data$Y)
    coeffcient <- coefficients[[j]]
    imputation <- rep(0,n)
      for (i in 1:n) {
        predict <- sum(coeffcient[1] + coeffcient[2:11] * missing_data[i, 2:11])
        imputation[i] <- rnorm(n = 1, mean =predict, sd = unlist(sigma[j]) )
      }
    missing_data <- missing_data |> dplyr::mutate("{missing_col}" := imputation)
    output <- output |> dplyr::bind_rows(missing_data)
  }
  return(output)
}

i <- get_single_imputation(data, coefs, sigma)
sum(c[1] + c[2:11] * m1[1, 2:11])


main()

m2  <- data |> dplyr::filter(R == 2)
predict <- sum(coefs[1] * m2[, 2:11])

m2[1, 2:11]

c <- coefs[[2]]

c
sum(c[2:11]* m1[1,2:11])
